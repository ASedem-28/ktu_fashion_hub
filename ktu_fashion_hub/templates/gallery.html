{% extends "base.html" %}
{% load static %}
{% load thumbnail %}

{% block title %}Gallery - KTU Fashion Hub{% endblock %}

{% block content %}
    
    <section class="gallery-hero">
        <h1>Our Gallery</h1>
        <p>Explore our curated fashion moments and standout student projects in a stunning visual grid.</p>
    </section>

    <main class="gallery-wrapper">
        <div class="gallery-filters">
            <button class="filter-btn active" data-category="all">All</button>
            <button class="filter-btn" data-category="men">Men's Wear</button>
            <button class="filter-btn" data-category="women">Women's Wear</button>
            <button class="filter-btn" data-category="patterns">Patterns & Textiles</button>
        </div>

        <div class="gallery-grid">
 
            {% for item in fashion_items %}
                {# ADDED: Check if a media file actually exists for this item #}
                {% if item.media_file %}

                    <a href="#" class="gallery-item" 
                    data-category="{{ item.category }}" 
                    data-media-url="{{ item.media_file.url }}"
                    data-media-type="{% if item.is_video %}video{% else %}image{% endif %}"
                    data-title="{{ item.title }}"
                    data-description="by {{ item.designer_name }}{% if item.designer_contact %} | {{ item.designer_contact }}{% endif %}">

                        {% if item.is_video %}
                            <video class="gallery-video" autoplay loop muted playsinline>
                                <source src="{{ item.media_file.url }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {% elif item.is_image %}
                            {% thumbnail item.media_file "720x900" crop="center" quality=100 as im %}
                                <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="{{ item.title }}" loading="lazy">
                            {% endthumbnail %}
                        {% endif %}

                        <div class="overlay">
                            <h3>{{ item.title }}</h3>
                            <p>by {{ item.designer_name }} <br/>
                                {% if item.designer_contact %}
                                    {{ item.designer_contact }}
                                {% endif %}
                            </p>
                        </div>
                    </a>

                {% endif %} {# End of the check for media_file #}
            {% empty %}
                <p style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                    No fashion items found. Check back soon!
                </p>
            {% endfor %}

        </div>
    </main>

    <!-- CHANGED: POPUP MODAL to be more flexible -->
    <div id="imageModal" class="modal media-modal">
        <button class="prev-btn"><i class="fa-solid fa-angle-left"></i></button>
         
        <div class="modal-content">
            <span class="close-btn">Ã—</span>
            <a id="downloadBtn" class="download-icon" href="" download>
                <i class="fas fa-download"></i>
            </a>
            
            {# This container will be filled by JavaScript #}
            <div id="modalMediaContainer"></div>

            <div class="modal-description">
              <h3 id="modalTitle">Title</h3>
              <p id="modalDesc">Description goes here...</p>
            </div>
        </div>

        <button class="next-btn"><i class="fa-solid fa-angle-right"></i></button>
    </div>
    
{% endblock %}